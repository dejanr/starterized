#!/usr/bin/env node

'use strict';

var program = require('commander');
var path = require('path');

var initialize = require('../commands/initialize').action;
var serve = require('../commands/serve').action;
var layout = require('../commands/layout').action;
var page = require('../commands/page').action;
var partial = require('../commands/partial').action;

program.usage('[options] [command] [arguments]');

program.option('-v, --verbose', 'show verbose messages');
program.option('-f, --force', 'force command execution');
program.option('-c, --cwd [cwd]', 'execute inside specified working dir');

program
  .command('init [dir]')
  .description('Initialize new project inside [dir]:\n' +
               '                       - defaults to existing public or web folder\n' +
               '                       - fallbacks to current working directory\n' +
               '                       - or use optional [dir] path when specified')
  .action(function(dir) {
    var cwd = program.cwd ? path.resolve(program.cwd) : undefined;
    initialize(cwd, dir, {
      verbose: program.verbose,
      force: program.force
    });
  });

program
  .command('serve')
  .description('Serve markup files and livereload assets on change.')
  .action(serve);

program
  .command('layout <name>')
  .description('Generate markup layout with <name>.')
  .action(layout);

program
  .command('page <name> [layout]')
  .description('Generate markup page with <name> which extends [layout].')
  .action(page);

program
  .command('partial <name>')
  .description('Generate markup partial with <name> which extends [parent].')
  .action(partial);

program.parse(process.argv);

if (process.argv.length === 2) {
  program.help();
}
